/*!
 * D3 Schedule 0.1.0
 * 
 * @author Mikael Jorhult 
 * @license https://github.com/mikaeljorhult/d3-schedule MIT
*/
define("Events",[],function(){return{cache:{},publish:function(e,t,n){if(this.cache[e]){var r=this.cache[e],i=r.length-1;for(i;i>=0;i-=1)r[i].apply(n||this,t||[])}},subscribe:function(e,t){return this.cache[e]||(this.cache[e]=[]),this.cache[e].push(t),[e,t]},unsubscribe:function(e,t){var n=e[0],r=this.cache[n].length-1;if(this.cache[n])for(r;r>=0;r-=1)this.cache[n][r]===e[1]&&(this.cache[n].splice(this.cache[n][r],1),t&&delete this.cache[n])}}}),define("d3-schedule",["d3","Events"],function(e,t){function p(t){return r=e.selectAll(t),i=r.append("svg"),y(),n}function d(e){return a=e,v()}function v(){return e.json(a,function(e,n){u=n,t.publish("objects:updated")}),n}function m(){if(u!==undefined&&u.length<1)return;var t=i.selectAll("g.object").data(u).enter();t.append("g").attr("x",0).attr("y",function(e,t){return t*h}).attr("width",f).attr("height",h).attr("class","object").each(function(t,n){var r=e.select(this),i=r.selectAll("rect").data(t.bookings).enter();r.append("rect").attr("x",0).attr("y",n*h).attr("width","100%").attr("height",h).attr("fill","transparent").attr("class","row"),r.append("svg:text").text(t.name).attr("x",0).attr("y",n*h+.625*h).attr("height",h),i.append("rect").attr("rx",3).attr("ry",3).attr("y",n*h).attr("x",function(e){return o(s.parse(e.startTime))}).attr("height",h-2).attr("width",function(e){return o(s.parse(e.endTime))-o(s.parse(e.startTime))}).attr("fill",function(e){return e.color}).attr("class","booking")})}function g(){return parseInt(r.style("width"),10)}function y(){f=g(),o.range([c,f]),i.attr("width",f).attr("height",l),u.length>0&&(i.selectAll(".object").attr("width",f),i.selectAll(".booking").attr("x",function(e){return o(s.parse(e.startTime))}).attr("width",function(e){return o(s.parse(e.endTime))-o(s.parse(e.startTime))}))}var n,r,i,s=e.time.format("%Y-%m-%d %H:%M:%S"),o=e.time.scale(),u=[],a,f=400,l=400,c=150,h=24;return n={setElement:p,setSource:d,update:v},e.select(window).on("resize",y),t.subscribe("objects:updated",function(){o=e.time.scale().domain([e.min(u,function(t){return e.min(t.bookings,function(e){return s.parse(e.startTime)})}),e.max(u,function(t){return e.max(t.bookings,function(e){return s.parse(e.endTime)})})]).range([c,f]),l=h*u.length,m()}),n});