/*!
 * D3 Schedule 0.1.0
 * 
 * @author Mikael Jorhult 
 * @license https://github.com/mikaeljorhult/d3-schedule MIT
*/
define("Events",[],function(){return{cache:{},publish:function(e,t,n){if(this.cache[e]){var r=this.cache[e],i=r.length-1;for(i;i>=0;i-=1)r[i].apply(n||this,t||[])}},subscribe:function(e,t){return this.cache[e]||(this.cache[e]=[]),this.cache[e].push(t),[e,t]},unsubscribe:function(e,t){var n=e[0],r=this.cache[n].length-1;if(this.cache[n])for(r;r>=0;r-=1)this.cache[n][r]===e[1]&&(this.cache[n].splice(this.cache[n][r],1),t&&delete this.cache[n])}}}),define("d3-schedule",["d3","Events"],function(e,t){function d(t){return r=e.selectAll(t),i=r.append("svg"),E(),n}function v(e){return e!==!1&&r.style({height:e+"px","overflow-y":"scroll"}),n}function m(e){return l=e,n}function g(e){return h=e,y()}function y(){return e.json(h,function(e,n){n[p.results]!==undefined?c=n[p.results]:c=n,t.publish("objects:updated")}),n}function b(){if(c!==undefined&&c.length<1)return;var t=i.selectAll("g.object").data(c).enter();t.append("g").attr("x",0).attr("y",function(e,t){return t*l}).attr("width",u).attr("height",l).attr("class","object").each(function(t,n){var r=e.select(this),i=r.selectAll("rect").data(t[p.events]).enter();r.append("rect").attr("x",0).attr("y",n*l).attr("width","100%").attr("height",l).attr("fill","transparent").attr("class","row"),r.append("svg:text").text(t.name).attr("x",0).attr("y",n*l+.625*l).attr("height",l),i.append("rect").attr("rx",3).attr("ry",3).attr("y",n*l).attr("x",function(e){return o(s.parse(e[p.start]))}).attr("height",l-2).attr("width",function(e){return o(s.parse(e[p.end]))-o(s.parse(e[p.start]))}).attr("fill",function(e){return e.color}).attr("class","event")})}function w(){return parseInt(r.style("width"),10)}function E(){u=w(),o.range([f,u]),i.attr("width",u).attr("height",a),c.length>0&&(i.selectAll(".object").attr("width",u),i.selectAll(".event").attr("x",function(e){return o(s.parse(e[p.start]))}).attr("width",function(e){return o(s.parse(e[p.end]))-o(s.parse(e[p.start]))}))}var n,r,i,s=e.time.format("%Y-%m-%d %H:%M:%S"),o=e.time.scale(),u=400,a=400,f=150,l=24,c=[],h,p={results:"results",start:"startTime",end:"endTime",events:"events"};return n={setElement:d,setHeight:v,setRowHeight:m,setSource:g,update:y},e.select(window).on("resize",E),t.subscribe("objects:updated",function(){o=e.time.scale().domain([e.min(c,function(t){return e.min(t[p.events],function(e){return s.parse(e[p.start])})}),e.max(c,function(t){return e.max(t[p.events],function(e){return s.parse(e[p.end])})})]).range([f,u]),a=l*c.length,b()}),n});