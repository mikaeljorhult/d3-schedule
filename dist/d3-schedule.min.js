/*!
 * D3 Schedule 0.1.0
 * 
 * @author Mikael Jorhult 
 * @license https://github.com/mikaeljorhult/d3-schedule MIT
*/
define("Events",[],function(){return{cache:{},publish:function(e,t,n){if(this.cache[e]){var r=this.cache[e],i=r.length-1;for(i;i>=0;i-=1)r[i].apply(n||this,t||[])}},subscribe:function(e,t){return this.cache[e]||(this.cache[e]=[]),this.cache[e].push(t),[e,t]},unsubscribe:function(e,t){var n=e[0],r=this.cache[n].length-1;if(this.cache[n])for(r;r>=0;r-=1)this.cache[n][r]===e[1]&&(this.cache[n].splice(this.cache[n][r],1),t&&delete this.cache[n])}}}),define("d3-schedule",["d3","Events"],function(e,t){function c(t){n=e.selectAll(t),r=n.append("svg")}function h(n){e.json(n,function(e,n){o=n,t.publish("objects:updated")})}function p(){if(o!==undefined&&o.length<1)return;var t=r.selectAll("g.object").data(o).enter();t.append("g").attr("x",0).attr("y",function(e,t){return t*l}).attr("width",u).attr("height",l).attr("class","object").each(function(t,n){var r=e.select(this),o=r.selectAll("rect").data(t.bookings).enter();r.append("rect").attr("x",0).attr("y",n*l).attr("width","100%").attr("height",l).attr("fill","transparent").attr("class","row"),r.append("svg:text").text(t.name).attr("x",0).attr("y",n*l+.625*l).attr("height",l),o.append("rect").attr("rx",3).attr("ry",3).attr("y",n*l).attr("x",function(e){return s(i.parse(e.startTime))}).attr("height",l-2).attr("width",function(e){return s(i.parse(e.endTime))-s(i.parse(e.startTime))}).attr("fill",function(e){return e.color}).attr("class","booking")})}function d(){return parseInt(n.style("width"),10)}function v(){if(o.length<1)return;u=d(),s.range([f,u]),r.attr("width",u).attr("height",a),r.selectAll(".object").attr("width",u),r.selectAll(".booking").attr("x",function(e){return s(i.parse(e.startTime))}).attr("width",function(e){return s(i.parse(e.endTime))-s(i.parse(e.startTime))})}var n,r,i=e.time.format("%Y-%m-%d %H:%M:%S"),s,o=[],u=400,a=400,f=150,l=24;return e.select(window).on("resize",v),v(),t.subscribe("objects:updated",function(){s=e.time.scale().domain([e.min(o,function(t){return e.min(t.bookings,function(e){return i.parse(e.startTime)})}),e.max(o,function(t){return e.max(t.bookings,function(e){return i.parse(e.endTime)})})]).range([f,u]),a=l*o.length,p()}),{setElement:c,setSource:h}});